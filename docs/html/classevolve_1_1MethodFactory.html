<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Evolve: evolve::MethodFactory Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="namespaceevolve.html">evolve</a>::<a class="el" href="classevolve_1_1MethodFactory.html">MethodFactory</a></div>
<h1>evolve::MethodFactory Class Reference</h1><!-- doxytag: class="evolve::MethodFactory" --><!-- doxytag: inherits="evolve::CommonAspect" --><code>#include &lt;<a class="el" href="MethodFactory_8h-source.html">MethodFactory.h</a>&gt;</code>
<p>
<div class="dynheader">
Inheritance diagram for evolve::MethodFactory:</div>
<div class="dynsection">

<p><center><img src="classevolve_1_1MethodFactory.png" usemap="#evolve::MethodFactory_map" border="0" alt=""></center>
<map name="evolve::MethodFactory_map">
<area href="classevolve_1_1CommonAspect.html" alt="evolve::CommonAspect" shape="rect" coords="0,0,143,24">
</map>
</div>

<p>
<a href="classevolve_1_1MethodFactory-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
class for generating method trampolines (for runtime function call generation) This allows function calls to be generated during runtime. 
<p>
And example use of this would be a class (named class A) that exposes metadata about it functions. Another class (named class B) could parse that data, and use this object, along with the metadata, to invoke class A's methods <em>without</em> needing to know anything about it at compile time.<p>
Currently, the method specification this is capable of parsing is: <br>
 ret:[dword],[dword|this],[dword],[dword],.... <br>
 Hopefully, it will eventually support: <br>
 ret:[dword|obj(size)],[dword|obj(size)],[dword|obj(size)]....<br>
 Currently, there are no plans for floating point arguments, althought I haven't ruled it out.. <table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classevolve_1_1MethodFactory.html#c9bc364acf0bf1e332e0e694e8f58092">MethodFactory</a> (void *<a class="el" href="classevolve_1_1MethodFactory.html#5b69bfd4829e16f612fe573196b644e4">obj</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Construct a method factory.  <a href="#c9bc364acf0bf1e332e0e694e8f58092"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classevolve_1_1MethodFactory.html#1d6e62a0e335f066625887ff4b25f7db">~MethodFactory</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classevolve_1_1MethodFactory.html#47ad224bf254f24e44ced419347d771d">addMethod</a> (const string &amp;methodId, const string &amp;methodSpecification, <a class="el" href="AsmTypes_8h.html#74cb93d430006e784da73b8ca406ee6e">dword</a> methodAddr, bool printDebug=DO_DEBUG)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a method to this factory.  <a href="#47ad224bf254f24e44ced419347d771d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classevolve_1_1MethodFactory.html#ef607924285bcee31597cc7a29fa7ada">callMethod</a> (const string &amp;methodId, unsigned char *args, unsigned int argSize, unsigned char *&amp;ret, unsigned int &amp;retSize, bool printDebug=DO_DEBUG)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Invokes a method that has been added to this factory.  <a href="#ef607924285bcee31597cc7a29fa7ada"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">map&lt; string, string &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classevolve_1_1MethodFactory.html#a88281de100007554203d98a29f60691">getInterfaces</a> (bool printDebug=DO_DEBUG)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the current set of interfaces added to this object.  <a href="#a88281de100007554203d98a29f60691"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classevolve_1_1MethodFactory.html#d6024f13d248f0f3922972f534c02cea">parseSpecification</a> (const string &amp;spec, string &amp;interface, bool printDebug=DO_DEBUG)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Not currently used.  <a href="#d6024f13d248f0f3922972f534c02cea"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="AsmTypes_8h.html#74cb93d430006e784da73b8ca406ee6e">dword</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classevolve_1_1MethodFactory.html#5b69bfd4829e16f612fe573196b644e4">obj</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">map&lt; string, string &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classevolve_1_1MethodFactory.html#c7be4ae7b6ffc38e83d09b6daadc1af9">interfaces</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">map&lt; string, <a class="el" href="AsmTypes_8h.html#74cb93d430006e784da73b8ca406ee6e">dword</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classevolve_1_1MethodFactory.html#97008e89c7d779576815efca7b63bc28">methods</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">Serializer&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classevolve_1_1MethodFactory.html#ea6a6e3f6591f02fd4db4426e37de006">serializer</a></td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="c9bc364acf0bf1e332e0e694e8f58092"></a><!-- doxytag: member="evolve::MethodFactory::MethodFactory" ref="c9bc364acf0bf1e332e0e694e8f58092" args="(void *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MethodFactory::MethodFactory           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>obj</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Construct a method factory. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>If this method factory is to generate function calls using a class, pass the reference to the class here. Otherwise, pass NULL</td></tr>
  </table>
</dl>
Note that if you do not pass an object here, you should not use the "this" nonmenclature in the method specification. However, you could simply pass the pointer to the object in in the callMethod args argument. And add a "dword" in front of the method spec (for the this pointer) 
</div>
</div><p>
<a class="anchor" name="1d6e62a0e335f066625887ff4b25f7db"></a><!-- doxytag: member="evolve::MethodFactory::~MethodFactory" ref="1d6e62a0e335f066625887ff4b25f7db" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual evolve::MethodFactory::~MethodFactory           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="47ad224bf254f24e44ced419347d771d"></a><!-- doxytag: member="evolve::MethodFactory::addMethod" ref="47ad224bf254f24e44ced419347d771d" args="(const string &amp;methodId, const string &amp;methodSpecification, dword methodAddr, bool printDebug=DO_DEBUG)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool MethodFactory::addMethod           </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&nbsp;</td>
          <td class="paramname"> <em>methodId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&nbsp;</td>
          <td class="paramname"> <em>methodSpecification</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="AsmTypes_8h.html#74cb93d430006e784da73b8ca406ee6e">dword</a>&nbsp;</td>
          <td class="paramname"> <em>methodAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>printDebug</em> = <code>DO_DEBUG</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Add a method to this factory. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>methodId</em>&nbsp;</td><td>A unique id identifying this method </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>methodSpecification</em>&nbsp;</td><td>The specification outlining this methods return values and arguments </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>methodAddr</em>&nbsp;</td><td>The address of this method </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="ef607924285bcee31597cc7a29fa7ada"></a><!-- doxytag: member="evolve::MethodFactory::callMethod" ref="ef607924285bcee31597cc7a29fa7ada" args="(const string &amp;methodId, unsigned char *args, unsigned int argSize, unsigned char *&amp;ret, unsigned int &amp;retSize, bool printDebug=DO_DEBUG)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool MethodFactory::callMethod           </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&nbsp;</td>
          <td class="paramname"> <em>methodId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>argSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&amp;&nbsp;</td>
          <td class="paramname"> <em>ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&nbsp;</td>
          <td class="paramname"> <em>retSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>printDebug</em> = <code>DO_DEBUG</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Invokes a method that has been added to this factory. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>methodId</em>&nbsp;</td><td>the id of the method to be called </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td>An array of bytes that contain any data to be pushed onto the stack </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>argSize</em>&nbsp;</td><td>the size of the args array </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ret</em>&nbsp;</td><td>An array of bytes (should be initialized to NULL, and deleted by the user), that contains any values returned by the method </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>retSize</em>&nbsp;</td><td>The size of the ret array (after it has been allocated by this method) </td></tr>
  </table>
</dl>

<p>
TODO check for in-memory returns<p>
We need a class above this that handles objects appropriately, and just passes the addresses as dwords to this class... looks like it's time to start on serialization...<p>
Actually (I may be stumbling onto something brilliant here..) I think we need an _object factory_ class, with each instance of the object factory handling a different class. To register with an object factory, a class needs to give: A) the address of its _deserialization_ function B) A buffer that can be handled by it'd deserialization function <a class="el" href="namespaceC.html">C</a>) A method spec for it's deserialization function, using only dword or this args.<ul>
<li>subpoint - probably best that the deserialization function is inherited from <a class="el" href="classevolve_1_1CommonAspect.html" title="Various aspects of evolve objects that cut across all objects.">CommonAspect</a>. Then point (<a class="el" href="namespaceC.html">C</a>) goes away, since we always know what the method spec looks like... D) Possibly a "this" pointer (if required by the method spec we settle on... ) This "this" pointer would point at a newly created object, ready to be deserialized into We would be passing this to the deserialization call generated by a methodFactory</li></ul>
<p>
NOW, (and here's the possible genius part), the object factory can use the method factory to call the deserialization function, and the "this" pointer becomes our pointer at the object. Now we can just look up the object in our object registry and call makeObject() (which will call the registered deserialization function, and hand us the address of the object). and push the address on! AND the methodFactory would then have a registry of object factories that could be used with "obj" arguments. They would provide something like "obj(RegisteredObjectID)". We would look up the id, and serialize it here. Thus we can bootstrap a reflection framework that can handle a reasonable subset of C++ types.<p>
The question is how do we handle non-evolve objects (without a generic deserialization function) We could handle those with static deserialization methods, but either way that's done in the objectFactory class.. We would need both a "makeContiguousObject" that can handle all primitive types. This could be part of the class itself, and it could read in a spec and run-time and register those types automatically. And then we would need outside classes that handle stuff like vectors and maps... 
</div>
</div><p>
<a class="anchor" name="a88281de100007554203d98a29f60691"></a><!-- doxytag: member="evolve::MethodFactory::getInterfaces" ref="a88281de100007554203d98a29f60691" args="(bool printDebug=DO_DEBUG)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">map&lt; string, string &gt; MethodFactory::getInterfaces           </td>
          <td>(</td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>printDebug</em> = <code>DO_DEBUG</code>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the current set of interfaces added to this object. 
<p>

</div>
</div><p>
<a class="anchor" name="d6024f13d248f0f3922972f534c02cea"></a><!-- doxytag: member="evolve::MethodFactory::parseSpecification" ref="d6024f13d248f0f3922972f534c02cea" args="(const string &amp;spec, string &amp;interface, bool printDebug=DO_DEBUG)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool MethodFactory::parseSpecification           </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&nbsp;</td>
          <td class="paramname"> <em>spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string &amp;&nbsp;</td>
          <td class="paramname"> <em>interface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>printDebug</em> = <code>DO_DEBUG</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Not currently used. 
<p>
All parsing is currently done in the callMethod class Eventually, what we should do is call this in callMethod, and this translates the method spec given by the user into the low-level one that is understood by the callMethod call. 
</div>
</div><p>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="5b69bfd4829e16f612fe573196b644e4"></a><!-- doxytag: member="evolve::MethodFactory::obj" ref="5b69bfd4829e16f612fe573196b644e4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="AsmTypes_8h.html#74cb93d430006e784da73b8ca406ee6e">dword</a> <a class="el" href="classevolve_1_1MethodFactory.html#5b69bfd4829e16f612fe573196b644e4">evolve::MethodFactory::obj</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="c7be4ae7b6ffc38e83d09b6daadc1af9"></a><!-- doxytag: member="evolve::MethodFactory::interfaces" ref="c7be4ae7b6ffc38e83d09b6daadc1af9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">map&lt;string,string&gt; <a class="el" href="classevolve_1_1MethodFactory.html#c7be4ae7b6ffc38e83d09b6daadc1af9">evolve::MethodFactory::interfaces</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="97008e89c7d779576815efca7b63bc28"></a><!-- doxytag: member="evolve::MethodFactory::methods" ref="97008e89c7d779576815efca7b63bc28" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">map&lt;string,<a class="el" href="AsmTypes_8h.html#74cb93d430006e784da73b8ca406ee6e">dword</a>&gt; <a class="el" href="classevolve_1_1MethodFactory.html#97008e89c7d779576815efca7b63bc28">evolve::MethodFactory::methods</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="ea6a6e3f6591f02fd4db4426e37de006"></a><!-- doxytag: member="evolve::MethodFactory::serializer" ref="ea6a6e3f6591f02fd4db4426e37de006" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Serializer <a class="el" href="classevolve_1_1MethodFactory.html#ea6a6e3f6591f02fd4db4426e37de006">evolve::MethodFactory::serializer</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr>The documentation for this class was generated from the following files:<ul>
<li>reflectionLearn/methodFactory/<a class="el" href="MethodFactory_8h-source.html">MethodFactory.h</a><li>reflectionLearn/methodFactory/<a class="el" href="MethodFactory_8cc.html">MethodFactory.cc</a></ul>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Nov 26 21:29:28 2007 for Evolve by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
